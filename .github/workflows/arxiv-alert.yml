name: arXiv Topic Alert
on:
  schedule:
    - cron: "10 7 * * *"   # 08:10 Paris (CET=UTC+1). Adjust when CEST returns if you care.
  workflow_dispatch: {}
jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Cache state
        uses: actions/cache@v4
        with:
          path: arxiv_state.json
          key: arxiv-state
      - uses: actions/setup-python@v5
        with: { python-version: "3.x" }
      - name: Run alert
        env:
          # Delivery (optional)
          SMTP_HOST: ${{ secrets.SMTP_HOST }}
          SMTP_PORT: ${{ secrets.SMTP_PORT }}
          SMTP_USER: ${{ secrets.SMTP_USER }}
          SMTP_PASS: ${{ secrets.SMTP_PASS }}
          SMTP_FROM: ${{ secrets.SMTP_FROM }}
          SMTP_TO:   ${{ secrets.SMTP_TO }}
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
          # Scope / filters (optional)
          ARXIV_CATEGORIES: ${{ secrets.ARXIV_CATEGORIES }}
          ARXIV_MAIN_QUERY: ${{ secrets.ARXIV_MAIN_QUERY }}
          ARXIV_REQUIRED_KEYWORDS: ${{ secrets.ARXIV_REQUIRED_KEYWORDS }}
          ARXIV_ANY_KEYWORDS: ${{ secrets.ARXIV_ANY_KEYWORDS }}
          ARXIV_DAYS_BACK:  ${{ secrets.ARXIV_DAYS_BACK }}
          ARXIV_MAX_RESULTS: ${{ secrets.ARXIV_MAX_RESULTS }}
          DIGEST_MAX_ITEMS: ${{ secrets.DIGEST_MAX_ITEMS }}
          SHOW_ABSTRACT:    ${{ secrets.SHOW_ABSTRACT }}
          STATE_FILE: arxiv_state.json
        run: python3 arxiv_topic_alert.py | tee digest.txt
      - name: Upload digest (optional)
        uses: actions/upload-artifact@v4
        with: { name: latest-digest, path: digest.txt }
